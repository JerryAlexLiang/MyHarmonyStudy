import router from '@ohos.router';
import CommonConstants from '../common/constants/CommonConstants';
import { DataItemBean } from '../viewmodel/DataItemBean';
import prompt from '@system.prompt';
// import DataItemBean from '../viewmodel/DataItemBean';

@Component
export default struct StudentListItem {
  // private name?: string;
  // private imageUrl?: string;

  @State studentData?: DataItemBean = undefined;
  private index: number;

  // @State isListModel: boolean = true;
  // ä»çˆ¶ç»„ä»¶å•å‘åŒæ­¥çŠ¶æ€ï¼š@Prop
  @Prop isListModel: boolean;

  // æ˜¯å¦é€‰ä¸­å½“å‰Item
  @State isChecked: boolean = false;

  // åˆ—è¡¨Itemå­é¡¹Imageç‚¹å‡»äº‹ä»¶
  onItemChildImageClick: () => void

  // 1ã€ArkUIæä¾›äº†@Linkè£…é¥°å™¨ï¼Œç”¨äºä¸çˆ¶ç»„ä»¶åŒå‘åŒæ­¥çŠ¶æ€ã€‚å½“å­ç»„ä»¶StudentListItemä¸­çš„clickIndexç”¨@Linkä¿®é¥°ï¼Œå¯ä¸çˆ¶ç»„ä»¶StudentListPageä¸­çš„clickIndexå»ºç«‹åŒå‘åŒæ­¥å…³ç³»ã€‚
  // 2ã€ArkUIä¸­ç›‘å¬çŠ¶æ€å˜åŒ–@Watchçš„èƒ½åŠ›ã€‚ç”¨@Watchä¿®é¥°çš„çŠ¶æ€ï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘å£°æ˜æ—¶å®šä¹‰çš„å›è°ƒã€‚
  // ç»™StudentListItemçš„ä¸­çš„clickIndexçŠ¶æ€åŠ ä¸Š@Watch("onClickIndexChanged")ã€‚è¿™è¡¨ç¤ºéœ€è¦ç›‘å¬clickIndexçŠ¶æ€çš„å˜åŒ–ã€‚
  @Link @Watch('onClickIndexChanged') clickIndex: number;

  // å½“clickIndexçŠ¶æ€å˜åŒ–æ—¶ï¼Œå°†è§¦å‘onClickIndexChangedå›è°ƒï¼šå¦‚æœç‚¹å‡»çš„åˆ—è¡¨é¡¹ç´¢å¼•ä¸ç­‰äºå½“å‰åˆ—è¡¨é¡¹ç´¢å¼•ï¼Œåˆ™å°†isExpandedçŠ¶æ€ç½®ä¸ºfalseï¼Œä»è€Œæ”¶èµ·è¯¥ç›®æ ‡é¡¹ã€‚
  onClickIndexChanged() {
    if (this.clickIndex != this.index) {
      this.isChecked = false;
    } else {
      this.isChecked = true;
    }
  }

  aboutToAppear() {
    console.log("DataItemBean", this.studentData.title)
    console.log("DataItemBean", this.studentData.image)
    console.log("isListModel", this.isListModel)
  }

  @Builder checkIcon(icon: Resource, width?: Length, height?: Length) {
    Image(icon)
      .objectFit(ImageFit.Contain)
      .width(width != null ? width : $r('app.float.checkbox_width'))
      .height(height != null ? height : $r('app.float.checkbox_height'))
    // .margin($r('app.float.checkbox_margin'))
  }

  showToast(message: string) {
    prompt.showToast({
      message: message
    })
  }

  build() {
    if (this.isListModel) {
      Column() {
        Row() {
          Row() {
            if (this.isChecked) {
              this.checkIcon($r('app.media.ic_checked'))
            } else {
              this.checkIcon($r('app.media.ic_unchecked'))
            }
          }
          .margin(10)

          // Text(this.name)
          Text(this.studentData.title)
            .fontColor(this.isChecked ? Color.Red : Color.Black)
            .fontSize(this.isChecked ? $r('app.float.item_checked_font_size') : $r('app.float.item_font_size'))
            .fontWeight(this.isChecked ? FontWeight.Bolder : FontWeight.Bold)
            .opacity(this.isChecked ? 0.5 : 1.0)
            .decoration({ type: this.isChecked ? TextDecorationType.Underline : TextDecorationType.None })

          Blank()

          if (this.isChecked) {
            Text("çˆ†")
              .margin({ right: 10 })
              .textAlign(TextAlign.Center)
              .fontWeight(600)
              .fontSize('14fp')
              .backgroundColor(Color.Red)
              .fontColor(Color.White)
              .borderRadius(5)
              .width(22)
              .height(22)
          }

          Image($r('app.media.ic_arrow_next'))
            .width('30vp')
            .height('30vp')
            .margin({ right: '10vp' })
            .onClick(() => {
              // console.log('Next Click' + this.name);
              console.log('Next Click' + this.studentData.title);
              console.log('Next Click' + this.studentData.image);

              router.pushUrl({
                // url: 'pages/StudentDetailPage',
                url: CommonConstants.STUDENT_DETAIL_URL,
                params: {
                  // name: this.name,
                  studentData: this.studentData
                }
              }).catch((error) => {
                console.log('Next Click', 'IndexPage push error' + JSON.stringify(error));
              })
            })
        }
        .width('100%')
        .height($r('app.float.list_item_height'))

        if (this.isChecked) {
          Row() {
            Text(this.studentData.title + " is very handsome!")
              .fontSize('18fp')
              .fontColor(Color.Blue)

            Blank()

            Image(this.studentData.image)
              // Image('https://c-ssl.duitang.com/uploads/item/201805/06/20180506084619_2svWA.jpeg')
              // ImageFitåŒ…å«ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š
              // Containï¼šä¿æŒå®½é«˜æ¯”è¿›è¡Œç¼©å°æˆ–è€…æ”¾å¤§ï¼Œä½¿å¾—å›¾ç‰‡å®Œå…¨æ˜¾ç¤ºåœ¨æ˜¾ç¤ºè¾¹ç•Œå†…
              // Coverï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¿æŒå®½é«˜æ¯”è¿›è¡Œç¼©å°æˆ–è€…æ”¾å¤§ï¼Œä½¿å¾—å›¾ç‰‡ä¸¤è¾¹éƒ½å¤§äºæˆ–ç­‰äºæ˜¾ç¤ºè¾¹ç•Œã€‚
              // Autoï¼šè‡ªé€‚åº”æ˜¾ç¤ºã€‚
              // Fillï¼šä¸ä¿æŒå®½é«˜æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°ï¼Œä½¿å¾—å›¾ç‰‡å……æ»¡æ˜¾ç¤ºè¾¹ç•Œã€‚
              // ScaleDownï¼šä¿æŒå®½é«˜æ¯”æ˜¾ç¤ºï¼Œå›¾ç‰‡ç¼©å°æˆ–è€…ä¿æŒä¸å˜ã€‚
              // Noneï¼šä¿æŒåŸæœ‰å°ºå¯¸æ˜¾ç¤ºã€‚
              .objectFit(ImageFit.Cover)
                // .backgroundColor(Color.Pink)
              .width('50vp')
              .height('50vp')
                // .border({ width: 1 })
                // .borderColor(Color.Yellow)
              .borderRadius(100)
                // .borderStyle(BorderStyle.Solid)
              .onClick(this.onItemChildImageClick)
          }
          .width('100%')
          .padding({ left: 10, right: 10 })
          .justifyContent(FlexAlign.SpaceAround)
          // ç»„å†…è½¬åœºåŠ¨ç”»
          .transition({ // è®¾ç½®Imageè½¬åœºåŠ¨ç”»
            type: TransitionType.Insert, // è®¾ç½®Imageçš„å…¥åœºåŠ¨ç”»
            scale: CommonConstants.COMPONENT_TRANSITION_SCALE_OPEN,
            opacity: CommonConstants.COMPONENT_TRANSITION_OPACITY
          })
          .transition({ // è®¾ç½®Imageè½¬åœºåŠ¨ç”»
            type: TransitionType.Delete, // è®¾ç½®Imageçš„é€€åœºåŠ¨ç”»
            scale: CommonConstants.COMPONENT_TRANSITION_SCALE_CLOSE,
            opacity: CommonConstants.COMPONENT_TRANSITION_OPACITY
          })
        }
      }
      .borderRadius(22)
      .backgroundColor($r('app.color.start_window_background'))
      .width('100%')
      .height(this.isChecked ? $r('app.float.list_item_expand_height') : $r('app.float.list_item_height'))
      // å±æ€§åŠ¨ç”»
      // animationå±æ€§ä½œç”¨åŸŸï¼šanimationè‡ªèº«ä¹Ÿæ˜¯ç»„ä»¶çš„ä¸€ä¸ªå±æ€§ï¼Œå…¶ä½œç”¨åŸŸä¸ºanimationä¹‹å‰ã€‚
      // å³äº§ç”Ÿå±æ€§åŠ¨ç”»çš„å±æ€§é¡»åœ¨animationä¹‹å‰å£°æ˜ï¼Œå…¶åå£°æ˜çš„å°†ä¸ä¼šäº§ç”Ÿå±æ€§åŠ¨ç”»
      // æ˜¾å¼åŠ¨ç”»æŠŠè¦æ‰§è¡ŒåŠ¨ç”»çš„å±æ€§çš„ä¿®æ”¹æ”¾åœ¨é—­åŒ…å‡½æ•°ä¸­è§¦å‘åŠ¨ç”»ï¼Œè€Œå±æ€§åŠ¨ç”»åˆ™æ— éœ€ä½¿ç”¨é—­åŒ…ï¼ŒæŠŠanimationå±æ€§åŠ åœ¨è¦åšå±æ€§åŠ¨ç”»çš„ç»„ä»¶çš„å±æ€§åå³å¯
      .animation({ duration: 600 })
      .onClick(() => {
        // this.isChecked = !this.isChecked;

        // ç»„ä»¶å†…è½¬åœºåŠ¨ç”»éœ€è¦é…åˆ animateTo æ‰èƒ½ç”Ÿæ•ˆï¼ŒåŠ¨æ•ˆæ—¶é•¿ã€æ›²çº¿ã€å»¶æ—¶è·Ÿéš animateTo ä¸­çš„é…ç½®
        // ğŸ“¢ï¼šç»„ä»¶å†…çš„è½¬åœºåŠ¨ç”»æ—¶é•¿ï¼ŒåŠ¨ç”»æ›²çº¿ç­‰åŠ¨ç”»å‚æ•°ä»¥ animationTo æ–¹æ³•è®¾ç½®çš„ä¸ºåŸºå‡†
        // æ˜¾ç¤ºåŠ¨ç”»-æ·»åŠ å±•å¼€åŠ¨ç”»
        animateTo({ duration: 1000 }, () => {
          this.isChecked = !this.isChecked;
        })

        // æ”¶èµ·éç‚¹å‡»Item
        this.clickIndex = this.index;

      })
    } else {
      Column() {
        Row() {
          Blank()

          Image($r('app.media.ic_arrow_next'))
            .width('15vp')
            .height('15vp')
            .margin(10)
            .onClick(() => {
              // console.log('Next Click' + this.name);
              console.log('Next Click' + this.studentData.title);
              console.log('Next Click' + this.studentData.image);

              router.pushUrl({
                // url: 'pages/StudentDetailPage',
                url: CommonConstants.STUDENT_DETAIL_URL,
                params: {
                  // name: this.name,
                  studentData: this.studentData
                }
              }).catch((error) => {
                console.log('Next Click', 'IndexPage push error' + JSON.stringify(error));
              })
            })
        }
        .width('100%')

        Blank()

        Row() {
          Row() {
            if (this.isChecked) {
              this.checkIcon($r('app.media.ic_checked'), '16vp', '16vp')
            } else {
              this.checkIcon($r('app.media.ic_unchecked'), '16vp', '16vp')
            }
          }
          .onClick(() => {
            this.isChecked = !this.isChecked;
          })
          .margin(5)

          Blank()

          Row() {
            Text(this.studentData.title)
              .fontColor(this.isChecked ? Color.Yellow : Color.White)
              .fontSize('12vp')
              .fontWeight(500)
              .opacity(this.isChecked ? 0.5 : 1.0)
              .decoration({ type: this.isChecked ? TextDecorationType.LineThrough : TextDecorationType.None })
          }
          .backgroundColor($r('app.color.transparent_backgroundColor'))
          .borderRadius({ topLeft: 8, bottomRight: 10 })
          .padding({ left: 8, right: 8, top: 4, bottom: 4 })
        }
        .alignItems(VerticalAlign.Bottom)
        .width('100%')
      }
      .borderRadius(10)
      .width('100%')
      // .height($r('app.float.grid_item_height'))
      // æŒ‡å®šå½“å‰ç»„ä»¶çš„é•¿å®½æ¯”
      .aspectRatio(1)
      .backgroundImage(this.studentData.image)
      .backgroundImageSize(ImageSize.Cover)
      .onClick(this.onItemChildImageClick)
    }
  }
}